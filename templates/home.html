{% extends "base.html" %}
{% block title %}Графики{% endblock title %}

{% block content %}
    <style>
        h2 {
            text-align: center;
            margin: 40px 0 20px;
            font-weight: 600;
            color: #333;
        }
        .chart-block {
            max-width: 900px;
            width: 100%;
            height: 550px;
            margin: 0 auto 40px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            box-sizing: border-box;
            overflow-x: auto;
        }
    </style>

    <h2>График по брендам</h2>
    <div id="brandChart" class="chart-block"></div>

    <h2>График по моделям</h2>
    <div id="modelChart" class="chart-block"></div>

    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function drawChart(containerId, chartData, xTitle) {
                const traces = chartData.datasets.map(ds => ({
                    x: chartData.labels,
                    y: ds.data,
                    name: ds.label,
                    type: 'bar',
                    marker: { opacity: 0.85 }
                }));

                const layout = {
                    barmode: 'stack',
                    xaxis: {
                        title: xTitle,
                        tickangle: -45,
                        tickfont: { size: 12 },
                        automargin: true
                    },
                    yaxis: {
                        title: 'Количество',
                        zeroline: true,
                        zerolinewidth: 2,
                        zerolinecolor: '#ccc'
                    },
                    legend: {
                        orientation: 'h',
                        y: -0.3,
                        font: { size: 13 }
                    },
                    margin: { t: 20, b: 140, l: 50, r: 30 },
                    plot_bgcolor: '#fff',
                    paper_bgcolor: '#fff',
                    hovermode: 'closest'
                };

                Plotly.newPlot(containerId, traces, layout, { responsive: true });
            }

            drawChart('brandChart', JSON.parse('{{ brand_chart_json|safe }}'), 'Бренд');
            drawChart('modelChart', JSON.parse('{{ model_chart_json|safe }}'), 'Модель');
        });
    </script>
{% endblock content %}